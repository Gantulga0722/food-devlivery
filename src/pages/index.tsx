import Head from "next/head";
import * as React from "react";
import { HomeDescktopComp, HomeInfo } from "@/components/home";
import { Container, Stack } from "@mui/material";
import { useFood } from "@/components/context/FoodContextProvider";
import { HomeSection } from "@/components/home/Section";
import { HomeSaleSec } from "@/components/home/HomeSaleSec";

type Category = {
  _id: string;
  name: string;
};

const Home = () => {
  const [cateData, setCateData] = React.useState<Category[]>([]);
  const { allFood } = useFood();
  const saleFoods = allFood.filter((food) => food.sale > 0).slice(0, 4);

  const BE_URL = "https://food-delivery-be-zeta.vercel.app/api/category";

  React.useEffect(() => {
    const handleGetCategory = async () => {
      const options = {
        method: "GET",
        headers: {
          "Content-Type": "application/json",
        },
      };
      const fetched_data = await fetch(BE_URL, options);
      const fetched_json = await fetched_data.json();
      console.log("fetchedCate", fetched_json.categories);
      setCateData(fetched_json.categories);
    };
    handleGetCategory();
  }, []);

  return (
    <>
      <Head>
        <title>Food Delivery</title>
        <meta name="description" content="Generated by create next app" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <link rel="icon" href="/Logo.svg" />
      </Head>

      <Stack
        width={"100%"}
        sx={{ backgroundColor: "#FFF" }}
        alignItems={"flex-start"}
        marginBottom={"120px"}
      >
        <HomeDescktopComp />
        <Container maxWidth={"xl"} sx={{ width: "1306px" }}>
          <HomeInfo />

          <Stack gap={"80px"}>
            <HomeSaleSec title="Хямдралтай" saleFoods={saleFoods} />
            {cateData.map((cat, index) => {
              const fourFoods = allFood
                .filter((food) => food.category == cat._id && food.sale == 0)
                .slice(0, 4);
              return (
                <Stack key={index} gap={"80px"}>
                  <HomeSection title={cat.name} food={fourFoods} />
                </Stack>
              );
            })}
          </Stack>
        </Container>
      </Stack>
    </>
  );
};
export default Home;
